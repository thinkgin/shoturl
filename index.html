<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Url Shortner - 短链接管理系统</title>
  <link rel="icon" href="//img.znnu.com/favicon.ico" type="image/x-icon">

  <!-- CDN资源 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui@2.13.0/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/vue@2.6.11/dist/vue.min.js"></script>
  <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>
  <script src="https://unpkg.com/element-ui@2.13.0/lib/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-clipboard2@0.3.1/dist/vue-clipboard.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <div id="app">
    <!-- 登录页面 -->
    <div v-if="!isLoggedIn" class="login-container">
      <el-card class="login-card">
        <div slot="header" class="clearfix">
          <span class="login-title">管理员登录</span>
        </div>
        <el-form :model="loginForm" :rules="loginRules" ref="loginForm">
          <el-form-item prop="password">
            <el-input
              v-model="loginForm.password"
              type="password"
              placeholder="请输入管理密码"
              @keyup.enter.native="handleLogin"
              show-password>
            </el-input>
          </el-form-item>
          <el-form-item>
            <el-button type="primary" @click="handleLogin" :loading="loginLoading" style="width: 100%;">
              登录
            </el-button>
          </el-form-item>
        </el-form>
      </el-card>
    </div>

    <!-- 管理界面 -->
    <div v-if="isLoggedIn" class="admin-container">
    <el-container>
        <el-header class="admin-header">
          <div class="header-content">
            <h1>Url Shortner</h1>
            <el-button type="text" @click="handleLogout" class="logout-btn">退出登录</el-button>
          </div>
        </el-header>
      <el-main>
          <!-- 添加短链接区域 -->
          <el-card class="add-url-card">
            <div slot="header" class="clearfix">
              <span>添加短链接</span>
            </div>
            <el-form :model="urlForm" inline>
              <el-form-item label="长链接">
                <el-input
                  v-model="urlForm.longUrl"
                  placeholder="请输入要缩短的URL"
                  style="width: 400px;"
                  @keyup.enter.native="createShortUrl">
          </el-input>
              </el-form-item>
              <el-form-item label="自定义短码">
                <el-input
                  v-model="urlForm.shortKey"
                  placeholder="可选，留空自动生成"
                  style="width: 200px;">
          </el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="createShortUrl" :loading="createLoading">
                  缩短
                </el-button>
              </el-form-item>
            </el-form>
          </el-card>

          <!-- 数据列表区域 -->
          <el-card class="list-card">
            <div slot="header" class="clearfix">
              <span>短链接列表</span>
              <div style="float: right;">
                <el-button style="padding: 3px 0; margin-right: 10px;" type="text" @click="openApiDocs">API文档</el-button>
                <el-button style="padding: 3px 0" type="text" @click="loadUrlList">刷新</el-button>
              </div>
            </div>

            <!-- 搜索区域 -->
            <div class="search-area">
              <el-input
                v-model="searchKeyword"
                placeholder="搜索原始链接..."
                prefix-icon="el-icon-search"
                clearable
                @input="handleSearch"
                @clear="handleSearch"
                style="width: 300px;">
              </el-input>
              <span v-if="searchKeyword" class="search-result-info">
                找到 {{ filteredUrlList.length }} 条结果
              </span>
            </div>

                        <el-table :data="filteredUrlList" v-loading="listLoading" style="width: 100%">
              <el-table-column prop="shortKey" label="短码" width="120"></el-table-column>
              <el-table-column label="短链接" width="200">
                <template slot-scope="scope">
                  <el-link :href="getShortUrl(scope.row.shortKey)" target="_blank">
                    {{ getShortUrl(scope.row.shortKey) }}
                  </el-link>
                </template>
              </el-table-column>
              <el-table-column prop="longUrl" label="原始链接" min-width="300">
                <template slot-scope="scope">
                  <el-tooltip :content="scope.row.longUrl" placement="top">
                    <div class="url-text">{{ scope.row.longUrl }}</div>
                  </el-tooltip>
                </template>
              </el-table-column>
              <el-table-column label="操作" width="220" fixed="right">
                <template slot-scope="scope">
                  <div class="action-buttons">
                    <el-button size="mini" @click="copyToClipboard(getShortUrl(scope.row.shortKey))">复制</el-button>
                    <el-button size="mini" type="primary" @click="editUrl(scope.row)">编辑</el-button>
                    <el-button size="mini" type="danger" @click="deleteUrl(scope.row.shortKey)">删除</el-button>
        </div>
                </template>
              </el-table-column>
            </el-table>

            <!-- 分页 -->
            <el-pagination
              @size-change="handleSizeChange"
              @current-change="handleCurrentChange"
              :current-page="currentPage"
              :page-sizes="[10, 20, 50, 100]"
              :page-size="pageSize"
              layout="total, sizes, prev, pager, next, jumper"
              :total="total"
              style="margin-top: 20px; text-align: right;">
            </el-pagination>
          </el-card>
      </el-main>
    </el-container>
    </div>

    <!-- 编辑对话框 -->
    <el-dialog title="编辑短链接" :visible.sync="editDialogVisible" width="500px">
      <el-form :model="editForm" label-width="80px">
        <el-form-item label="短码">
          <el-input v-model="editForm.shortKey" disabled></el-input>
        </el-form-item>
        <el-form-item label="原始链接">
          <el-input v-model="editForm.longUrl" type="textarea" :rows="3"></el-input>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="editDialogVisible = false">取 消</el-button>
        <el-button type="primary" @click="updateUrl">确 定</el-button>
      </div>
    </el-dialog>

    <!-- API文档对话框 -->
    <el-dialog title="API 文档" :visible.sync="apiDocsVisible" width="80%" top="5vh">
      <div class="api-docs-container">
        <el-tabs v-model="activeApiTab" type="border-card">
          <!-- 登录API -->
          <el-tab-pane label="管理员登录" name="login">
            <div class="api-section">
              <h3>POST /api/login</h3>
              <p><strong>描述：</strong>管理员登录验证</p>
              <h4>请求参数：</h4>
              <el-table :data="loginApiParams" size="small" style="margin-bottom: 20px;">
                <el-table-column prop="name" label="参数名" width="120"></el-table-column>
                <el-table-column prop="type" label="类型" width="80"></el-table-column>
                <el-table-column prop="required" label="必需" width="60"></el-table-column>
                <el-table-column prop="description" label="描述"></el-table-column>
              </el-table>
              <h4>在线测试：</h4>
              <el-form inline>
                <el-form-item label="密码">
                  <el-input v-model="testLogin.password" type="password" placeholder="输入管理密码"></el-input>
                </el-form-item>
                <el-form-item>
                  <el-button type="primary" @click="testLoginApi" :loading="testLoading.login">测试登录</el-button>
                </el-form-item>
              </el-form>
              <div v-if="testResults.login" class="test-result">
                <h4>响应结果：</h4>
                <pre>{{ testResults.login }}</pre>
              </div>
            </div>
          </el-tab-pane>

          <!-- 创建短链接API -->
          <el-tab-pane label="创建短链接" name="create">
            <div class="api-section">
              <h3>POST /short</h3>
              <p><strong>描述：</strong>创建新的短链接</p>
              <h4>请求参数：</h4>
              <el-table :data="createApiParams" size="small" style="margin-bottom: 20px;">
                <el-table-column prop="name" label="参数名" width="120"></el-table-column>
                <el-table-column prop="type" label="类型" width="80"></el-table-column>
                <el-table-column prop="required" label="必需" width="60"></el-table-column>
                <el-table-column prop="description" label="描述"></el-table-column>
              </el-table>
              <h4>在线测试：</h4>
              <el-form inline>
                <el-form-item label="长链接">
                  <el-input v-model="testCreate.longUrl" placeholder="https://example.com" style="width: 300px;"></el-input>
                </el-form-item>
                <el-form-item label="自定义短码">
                  <el-input v-model="testCreate.shortKey" placeholder="可选" style="width: 150px;"></el-input>
                </el-form-item>
                <el-form-item>
                  <el-button type="primary" @click="testCreateApi" :loading="testLoading.create">测试创建</el-button>
                </el-form-item>
              </el-form>
              <div v-if="testResults.create" class="test-result">
                <h4>响应结果：</h4>
                <pre>{{ testResults.create }}</pre>
              </div>
            </div>
          </el-tab-pane>

          <!-- 获取列表API -->
          <el-tab-pane label="获取列表" name="list">
            <div class="api-section">
              <h3>GET /api/list</h3>
              <p><strong>描述：</strong>获取短链接列表（分页）</p>
              <h4>请求参数：</h4>
              <el-table :data="listApiParams" size="small" style="margin-bottom: 20px;">
                <el-table-column prop="name" label="参数名" width="120"></el-table-column>
                <el-table-column prop="type" label="类型" width="80"></el-table-column>
                <el-table-column prop="required" label="必需" width="60"></el-table-column>
                <el-table-column prop="description" label="描述"></el-table-column>
              </el-table>
              <h4>在线测试：</h4>
              <el-form inline>
                <el-form-item label="页码">
                  <el-input-number v-model="testList.page" :min="1" style="width: 100px;"></el-input-number>
                </el-form-item>
                <el-form-item label="每页数量">
                  <el-select v-model="testList.pageSize" style="width: 100px;">
                    <el-option label="10" :value="10"></el-option>
                    <el-option label="20" :value="20"></el-option>
                    <el-option label="50" :value="50"></el-option>
                  </el-select>
                </el-form-item>
                <el-form-item>
                  <el-button type="primary" @click="testListApi" :loading="testLoading.list">测试获取</el-button>
                </el-form-item>
              </el-form>
              <div v-if="testResults.list" class="test-result">
                <h4>响应结果：</h4>
                <pre>{{ testResults.list }}</pre>
              </div>
            </div>
          </el-tab-pane>

          <!-- 删除API -->
          <el-tab-pane label="删除短链接" name="delete">
            <div class="api-section">
              <h3>POST /api/delete</h3>
              <p><strong>描述：</strong>删除指定的短链接</p>
              <h4>请求参数：</h4>
              <el-table :data="deleteApiParams" size="small" style="margin-bottom: 20px;">
                <el-table-column prop="name" label="参数名" width="120"></el-table-column>
                <el-table-column prop="type" label="类型" width="80"></el-table-column>
                <el-table-column prop="required" label="必需" width="60"></el-table-column>
                <el-table-column prop="description" label="描述"></el-table-column>
              </el-table>
              <h4>在线测试：</h4>
              <el-form inline>
                <el-form-item label="短码">
                  <el-input v-model="testDelete.shortKey" placeholder="要删除的短码"></el-input>
                </el-form-item>
                <el-form-item>
                  <el-button type="danger" @click="testDeleteApi" :loading="testLoading.delete">测试删除</el-button>
                </el-form-item>
              </el-form>
              <div v-if="testResults.delete" class="test-result">
                <h4>响应结果：</h4>
                <pre>{{ testResults.delete }}</pre>
              </div>
            </div>
          </el-tab-pane>
        </el-tabs>
      </div>
    </el-dialog>
  </div>

 <script>
    const SESSION_KEY = 'shorturl_admin_session';

    let app = new Vue({
      el: "#app",
      data() {
        return {
          // 登录相关
          isLoggedIn: false,
          loginLoading: false,
          loginForm: {
            password: ''
          },
          loginRules: {
            password: [
              { required: true, message: '请输入密码', trigger: 'blur' }
            ]
          },

          // URL管理相关
          urlForm: {
          longUrl: '',
            shortKey: ''
          },
          createLoading: false,

          // 数据列表
          urlList: [],
          filteredUrlList: [],
          listLoading: false,
          currentPage: 1,
          pageSize: 10,
          total: 0,
          searchKeyword: '',

          // 编辑对话框
          editDialogVisible: false,
          editForm: {
            shortKey: '',
            longUrl: ''
          },

          // API文档相关
          apiDocsVisible: false,
          activeApiTab: 'login',

          // API参数定义
          loginApiParams: [
            { name: 'password', type: 'string', required: '是', description: '管理员密码' }
          ],
          createApiParams: [
            { name: 'longUrl', type: 'string', required: '是', description: 'Base64编码的长链接' },
            { name: 'shortKey', type: 'string', required: '否', description: '自定义短码（可选）' },
            { name: 'password', type: 'string', required: '是', description: '管理员密码' }
          ],
          listApiParams: [
            { name: 'page', type: 'number', required: '否', description: '页码，默认1' },
            { name: 'pageSize', type: 'number', required: '否', description: '每页数量，默认10' },
            { name: 'password', type: 'string', required: '是', description: '管理员密码' }
          ],
          deleteApiParams: [
            { name: 'shortKey', type: 'string', required: '是', description: '要删除的短码' },
            { name: 'password', type: 'string', required: '是', description: '管理员密码' }
          ],

          // 测试数据
          testLogin: { password: '' },
          testCreate: { longUrl: '', shortKey: '' },
          testList: { page: 1, pageSize: 10 },
          testDelete: { shortKey: '' },

          // 测试状态
          testLoading: {
            login: false,
            create: false,
            list: false,
            delete: false
          },

          // 测试结果
          testResults: {
            login: '',
            create: '',
            list: '',
            delete: ''
          }
        }
      },
      created() {
        // 检查是否已登录
        this.checkLoginStatus();
      },
      mounted() {
        console.log('页面加载完成，登录状态:', this.isLoggedIn);
        if (this.isLoggedIn) {
          console.log('已登录，开始加载列表');
          this.loadUrlList();
        }
      },
      methods: {
        // 检查登录状态
        checkLoginStatus() {
          console.log('检查登录状态');
          const session = localStorage.getItem(SESSION_KEY);
          if (session) {
            const sessionData = JSON.parse(session);
            const now = new Date().getTime();
            // 检查会话是否过期（24小时）
            if (now - sessionData.timestamp < 24 * 60 * 60 * 1000) {
              console.log('会话有效，设置登录状态');
              this.isLoggedIn = true;
              // 在下一个tick中加载列表，确保DOM已更新
              this.$nextTick(() => {
                console.log('会话恢复后加载列表');
                this.loadUrlList();
              });
            } else {
              console.log('会话已过期');
              localStorage.removeItem(SESSION_KEY);
            }
          } else {
            console.log('未找到会话数据');
          }
        },

                // 登录处理
        handleLogin() {
          this.$refs.loginForm.validate((valid) => {
            if (valid) {
              this.loginLoading = true;

              // 通过API验证密码
              $.ajax({
                url: '/api/login',
                type: 'POST',
                data: {
                  password: this.loginForm.password
                },
                success: (res) => {
                  console.log('登录响应:', res);
                  if (res.code === 200) {
                    this.isLoggedIn = true;
                    // 保存会话和token
                    const sessionData = {
                      timestamp: new Date().getTime(),
                      logged: true,
                      token: res.data.token,
                      password: this.loginForm.password // 保存密码用于后续API调用
                    };
                    localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
                    this.$message.success('登录成功！');
                    console.log('登录成功，开始加载列表');
                    // 延迟一下再加载列表，确保页面状态更新完成
                    this.$nextTick(() => {
                      this.loadUrlList();
                    });
                  } else {
                    this.$message.error(res.message || '登录失败！');
                  }
                },
                error: () => {
                  this.$message.error('登录请求失败！');
                },
                complete: () => {
                  this.loginLoading = false;
                }
              });
            }
          });
        },

        // 退出登录
        handleLogout() {
          this.$confirm('确定要退出登录吗？', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
            this.isLoggedIn = false;
            localStorage.removeItem(SESSION_KEY);
            this.urlList = [];
            this.loginForm.password = '';
            this.$message.success('已退出登录');
          });
        },

        // 创建短链接
        createShortUrl() {
          if (!this.urlForm.longUrl.trim()) {
            this.$message.warning('请输入长链接');
            return;
          }

          let re = new RegExp('http(s*)://[^\s]*');
          if (re.exec(this.urlForm.longUrl) === null) {
            this.$message.warning('请输入正确格式的长链接');
            return;
          }

          this.createLoading = true;

          // 从localStorage获取保存的密码
          const session = localStorage.getItem(SESSION_KEY);
          const sessionData = session ? JSON.parse(session) : {};
          const password = sessionData.password || '';

          console.log('创建短链接 - 密码:', password ? '已获取' : '未获取');

          if (!password) {
            this.$message.error('未获取到登录密码，请重新登录');
            this.createLoading = false;
            this.isLoggedIn = false;
            return;
          }

            let data = new URLSearchParams();
          data.append("longUrl", btoa(this.urlForm.longUrl));
          data.append("shortKey", this.urlForm.shortKey || '');
          data.append("password", password);

          console.log('发送创建请求:', {
            url: '/short',
            longUrl: this.urlForm.longUrl,
            shortKey: this.urlForm.shortKey
          });

            $.ajax({
              url: '/short',
              type: 'POST',
              data: data.toString(),
              contentType: 'application/x-www-form-urlencoded; charset=utf-8',
              success: (res) => {
              console.log('创建响应:', res);
                if (res.Code === 1 && res.ShortUrl !== "") {
                this.$message.success("短链接创建成功！");
                this.urlForm.longUrl = '';
                this.urlForm.shortKey = '';
                this.loadUrlList(); // 刷新列表
              } else {
                this.$message.error("短链接创建失败：" + res.Message);
              }
            },
            error: (xhr, status, error) => {
              console.error('创建失败:', xhr.responseText, status, error);
              this.$message.error("短链接创建失败：" + (xhr.responseText || error));
            },
            complete: () => {
              this.createLoading = false;
            }
          });
        },

                        // 加载URL列表
        loadUrlList() {
          this.listLoading = true;

          // 从localStorage获取保存的密码
          const session = localStorage.getItem(SESSION_KEY);
          const sessionData = session ? JSON.parse(session) : {};
          const password = sessionData.password || '';

          console.log('加载列表 - 密码:', password ? '已获取' : '未获取');

          if (!password) {
            this.$message.error('未获取到登录密码，请重新登录');
            this.listLoading = false;
            this.isLoggedIn = false;
            return;
          }

          console.log('发送列表请求:', {
            url: '/api/list',
            page: this.currentPage,
            pageSize: this.pageSize
          });

          // 调用列表API
          $.ajax({
            url: '/api/list',
            type: 'GET',
            data: {
              page: this.currentPage,
              pageSize: this.pageSize,
              password: password
            },
            success: (res) => {
              console.log('列表响应:', res);
              if (res.code === 200) {
                this.urlList = res.data.list || [];
                this.total = res.data.total || 0;
                // 初始化过滤列表
                this.applyFilter();
                console.log('列表数据:', this.urlList);
              } else {
                this.$message.error('获取数据失败：' + res.message);
              }
            },
            error: (xhr, status, error) => {
              console.error('列表获取失败:', xhr.responseText, status, error);
              this.$message.error('获取数据失败：' + (xhr.responseText || error));
            },
            complete: () => {
              this.listLoading = false;
            }
          });
        },

        // 删除URL
        deleteUrl(shortKey) {
                    this.$confirm(`确定要删除短码 "${shortKey}" 吗？`, '确认删除', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
            // 从localStorage获取保存的密码
            const session = localStorage.getItem(SESSION_KEY);
            const sessionData = session ? JSON.parse(session) : {};
            const password = sessionData.password || '';

            $.ajax({
              url: '/api/delete',
              type: 'POST',
              data: {
                shortKey: shortKey,
                password: password
              },
              success: (res) => {
                if (res.code === 200) {
                  this.$message.success('删除成功');
                  this.loadUrlList();
                } else {
                  this.$message.error('删除失败：' + res.message);
                }
              },
              error: () => {
                this.$message.error('删除失败');
              }
            });
          });
        },

        // 复制到剪贴板
        copyToClipboard(text) {
          this.$copyText(text).then(() => {
            this.$message.success('已复制到剪贴板');
          }).catch(() => {
            this.$message.error('复制失败');
          });
        },

        // 获取短链接URL
        getShortUrl(shortKey) {
          return `${window.location.origin}/${shortKey}`;
        },

        // 分页处理
        handleSizeChange(val) {
          this.pageSize = val;
          this.currentPage = 1;
          this.loadUrlList();
        },

        handleCurrentChange(val) {
          this.currentPage = val;
          this.loadUrlList();
        },

        // 编辑URL
        editUrl(row) {
          this.editForm.shortKey = row.shortKey;
          this.editForm.longUrl = row.longUrl;
          this.editDialogVisible = true;
        },

        // 更新URL
        updateUrl() {
          if (!this.editForm.longUrl.trim()) {
            this.$message.warning('请输入长链接');
            return;
          }

          let re = new RegExp('http(s*)://[^\s]*');
          if (re.exec(this.editForm.longUrl) === null) {
            this.$message.warning('请输入正确格式的长链接');
            return;
          }

          // 从localStorage获取保存的密码
          const session = localStorage.getItem(SESSION_KEY);
          const sessionData = session ? JSON.parse(session) : {};
          const password = sessionData.password || '';

          $.ajax({
            url: '/api/update',
            type: 'POST',
            data: {
              shortKey: this.editForm.shortKey,
              longUrl: this.editForm.longUrl,
              password: password
            },
            success: (res) => {
              if (res.code === 200) {
                this.$message.success('更新成功');
                this.editDialogVisible = false;
                this.loadUrlList();
              } else {
                this.$message.error('更新失败：' + res.message);
              }
            },
            error: () => {
              this.$message.error('更新失败');
              }
            });
        },

        // 打开API文档
        openApiDocs() {
          this.apiDocsVisible = true;
        },

        // 测试登录API
        testLoginApi() {
          if (!this.testLogin.password) {
            this.$message.warning('请输入密码');
            return;
          }

          this.testLoading.login = true;
          $.ajax({
            url: '/api/login',
            type: 'POST',
            data: { password: this.testLogin.password },
            success: (res) => {
              this.testResults.login = JSON.stringify(res, null, 2);
            },
            error: (xhr) => {
              this.testResults.login = JSON.stringify({
                error: 'Request failed',
                status: xhr.status,
                message: xhr.responseText
              }, null, 2);
            },
            complete: () => {
              this.testLoading.login = false;
            }
          });
        },

        // 测试创建API
        testCreateApi() {
          if (!this.testCreate.longUrl) {
            this.$message.warning('请输入长链接');
            return;
          }

          // 从localStorage获取保存的密码
          const session = localStorage.getItem(SESSION_KEY);
          const sessionData = session ? JSON.parse(session) : {};
          const password = sessionData.password || '';

          this.testLoading.create = true;
          let data = new URLSearchParams();
          data.append("longUrl", btoa(this.testCreate.longUrl));
          data.append("shortKey", this.testCreate.shortKey || '');
          data.append("password", password);

          $.ajax({
            url: '/short',
            type: 'POST',
            data: data.toString(),
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            success: (res) => {
              this.testResults.create = JSON.stringify(res, null, 2);
            },
            error: (xhr) => {
              this.testResults.create = JSON.stringify({
                error: 'Request failed',
                status: xhr.status,
                message: xhr.responseText
              }, null, 2);
            },
            complete: () => {
              this.testLoading.create = false;
            }
          });
        },

        // 测试列表API
        testListApi() {
          // 从localStorage获取保存的密码
          const session = localStorage.getItem(SESSION_KEY);
          const sessionData = session ? JSON.parse(session) : {};
          const password = sessionData.password || '';

          this.testLoading.list = true;
          $.ajax({
            url: '/api/list',
            type: 'GET',
            data: {
              page: this.testList.page,
              pageSize: this.testList.pageSize,
              password: password
            },
            success: (res) => {
              this.testResults.list = JSON.stringify(res, null, 2);
            },
            error: (xhr) => {
              this.testResults.list = JSON.stringify({
                error: 'Request failed',
                status: xhr.status,
                message: xhr.responseText
              }, null, 2);
            },
            complete: () => {
              this.testLoading.list = false;
            }
          });
        },

        // 测试删除API
        testDeleteApi() {
          if (!this.testDelete.shortKey) {
            this.$message.warning('请输入短码');
            return;
          }

          // 从localStorage获取保存的密码
          const session = localStorage.getItem(SESSION_KEY);
          const sessionData = session ? JSON.parse(session) : {};
          const password = sessionData.password || '';

          this.testLoading.delete = true;
          $.ajax({
            url: '/api/delete',
            type: 'POST',
            data: {
              shortKey: this.testDelete.shortKey,
              password: password
            },
            success: (res) => {
              this.testResults.delete = JSON.stringify(res, null, 2);
            },
            error: (xhr) => {
              this.testResults.delete = JSON.stringify({
                error: 'Request failed',
                status: xhr.status,
                message: xhr.responseText
              }, null, 2);
            },
            complete: () => {
              this.testLoading.delete = false;
            }
          });
        },

        // 搜索处理
        handleSearch() {
          this.applyFilter();
        },

        // 应用过滤
        applyFilter() {
          if (!this.searchKeyword.trim()) {
            this.filteredUrlList = [...this.urlList];
          } else {
            const keyword = this.searchKeyword.toLowerCase();
            this.filteredUrlList = this.urlList.filter(item => {
              return item.longUrl.toLowerCase().includes(keyword) ||
                     item.shortKey.toLowerCase().includes(keyword);
            });
          }
        }
      }
    })
  </script>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Helvetica Neue', Arial, sans-serif;
    }

    /* 登录页面样式 */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .login-card {
      width: 100%;
      max-width: 400px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .login-title {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      text-align: center;
    }

    /* 管理界面样式 */
    .admin-container {
      background: #f5f5f5;
      min-height: 100vh;
    }

    .admin-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      height: 60px !important;
      line-height: 60px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 100%;
      padding: 0 20px;
    }

    .header-content h1 {
      margin: 0;
      font-size: 24px;
      font-weight: normal;
    }

    .logout-btn {
      color: white !important;
      font-size: 14px;
    }

    .logout-btn:hover {
      color: #f0f0f0 !important;
    }

    /* 卡片样式 */
    .add-url-card {
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
    }

    .list-card {
      border-radius: 8px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
    }

    /* 表格样式 */
    .el-table {
      border-radius: 8px;
      overflow: hidden;
    }

    .url-text {
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* 分页样式 */
    .el-pagination {
      padding: 20px 0;
    }

    /* 表单样式优化 */
    .el-form--inline .el-form-item {
      margin-bottom: 10px;
    }

    /* 按钮样式 */
    .el-button--primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
    }

    .el-button--primary:hover {
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .header-content {
        padding: 0 10px;
      }

      .header-content h1 {
        font-size: 20px;
      }

      .el-form--inline .el-form-item {
        display: block;
        margin-right: 0;
      }

      .el-form--inline .el-form-item .el-input {
        width: 100% !important;
      }

      .url-text {
        max-width: 200px;
      }
    }

    /* 链接样式 */
    .el-link {
      font-size: 12px;
    }

    /* 对话框样式 */
    .el-dialog {
      border-radius: 8px;
    }

    /* 卡片头部样式 */
    .el-card__header {
      background: #fafafa;
      border-bottom: 1px solid #ebeef5;
    }

    /* 表格行悬停效果 */
    .el-table tbody tr:hover > td {
      background-color: #f5f7fa !important;
    }

    /* 操作按钮样式 */
    .action-buttons {
      white-space: nowrap;
    }

    .action-buttons .el-button {
      margin-right: 5px;
    }

    .action-buttons .el-button:last-child {
      margin-right: 0;
    }

    /* API文档样式 */
    .api-docs-container {
      height: 70vh;
      overflow-y: auto;
    }

    .api-section {
      padding: 20px;
    }

    .api-section h3 {
      color: #409EFF;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .api-section h4 {
      color: #333;
      margin: 20px 0 10px 0;
      font-size: 14px;
    }

    .api-section p {
      margin: 10px 0;
      color: #666;
    }

    .test-result {
      margin-top: 20px;
      border: 1px solid #dcdfe6;
      border-radius: 4px;
      background-color: #fafafa;
    }

    .test-result h4 {
      margin: 0;
      padding: 10px 15px;
      background-color: #f5f7fa;
      border-bottom: 1px solid #dcdfe6;
      font-size: 14px;
    }

    .test-result pre {
      margin: 0;
      padding: 15px;
      background-color: #fff;
      color: #333;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      line-height: 1.5;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    /* 固定表格列样式 */
    .el-table .el-table__fixed-right {
      box-shadow: -1px 0 8px rgba(0, 0, 0, 0.12);
    }

        /* 搜索区域样式 */
    .search-area {
      padding: 15px 0;
      border-bottom: 1px solid #ebeef5;
      margin-bottom: 15px;
    }

    .search-result-info {
      margin-left: 15px;
      color: #909399;
      font-size: 14px;
    }

    /* 响应式API文档 */
    @media (max-width: 768px) {
      .api-docs-container {
        height: 60vh;
      }

      .api-section {
        padding: 15px;
      }

      .test-result pre {
        font-size: 11px;
        padding: 10px;
      }

      .search-area .el-input {
        width: 100% !important;
      }

      .search-result-info {
        display: block;
        margin: 10px 0 0 0;
      }
    }
  </style>
</body>

</html>
